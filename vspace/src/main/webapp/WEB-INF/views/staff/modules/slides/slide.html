<html layout:decorate="~{layouts/main_staff}">
<head>
<link rel="stylesheet"
	href="https://unpkg.com/easymde/dist/easymde.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

<style type="text/css">
.hova {
    background-color: #f2f2f2;
}
.EasyMDEContainer .CodeMirror-wrap{
    overflow-y: scroll;
    height: 400px;
}
</style>
<script th:inline="javascript">
//# sourceURL=click.js
var contentCount = [[${#lists.size(slideContents)}]];
var markDown = null;
var defaultValue;

$(function () {
	  $('[data-toggle="tooltip"]').tooltip()
});

function createImageBlock(reader, width) {
    var imageblock = $('<div id="current" class="valueDiv tab row"><img src="#" style="imgDiv tab row"/><input type="hidden" id="deleteImageId" /><a class="btn deleteImage" href="javascript:;" style="position: absolute; right:64px;"><i style="color: var(--error);" class="fas fa-trash-alt"></i></a></div>');
    imageblock.find('img').attr('src', reader.result);
    if(width > 800)
    	imageblock.find('img').attr('width', '800px');
    return imageblock;
}

function onMouseEnter(e){
    var target = $( e.target );
   
    $(".hova").removeClass("hova");
    $(e.target).addClass("hova");
    // This is needed to prevent only the p tag from being highlighted
    if(target.is('p')){
        $(e.target).parent().addClass("hova");
    }
    //prevent normal hover actions
    e.preventDefault();
}
function onMouseLeave(e) {
    $(this).removeClass("hova");
}

function onDoubleClick(e){
    // get to the nearest divs class attribute
    $(".EasyMDEContainer").remove();
    var divName = $(e.target).closest('div').attr('class');
    //if the div is a text content block 
    if(divName.includes("textDivStaff")){

    	$(e.target).closest('.textDivStaff').addClass("open");
        var description = $("div.open p:eq(0)").text();
    	defaultValue = description;

        $("#editTextAlert").show();
        markDown = new EasyMDE({element: $('#editTextBlock')[0]});
        markDown.value(description.trim());
        //remove card border
        $(".open").css('display', 'none');
        $(".open").css('overflow-y', 'scroll');
        $(".open").css('height', '400px');
    } else if(divName.includes("biblioDivStaff")){
	   $(e.target).closest('.biblioDivStaff').addClass("open");
	   var description = $("div.open p:eq(0)").text();
    	   defaultValue = description;
    	
    	   var title = $("div.open p span:eq(0)").text();
         var author = $("div.open p span:eq(1)").text();
         var year = $("div.open p span:eq(2)").text();
         var journal = $("div.open p span:eq(3)").text();
         var url = $("div.open p span:eq(4)").text();
         var volume = $("div.open p span:eq(5)").text();
         var issue = $("div.open p span:eq(6)").text();
         var pages = $("div.open p span:eq(7)").text();
         var editors = $("div.open p span:eq(8)").text();
         var type = $("div.open p span:eq(9)").text();
         var note = $("div.open p span:eq(10)").text();
    	
    	    //showing the edit bibliography form with all the respective values
    	    $("#editBiblioAlert").show();
    	
    	    $("#editTitleBiblio").val(title);
          $("#editAuthorBiblio").val(author);
          $("#editYearBiblio").val(year);
          $("#editJournalBiblio").val(journal);
          $("#editUrlBiblio").val(url);
          $("#editVolumeBiblio").val(volume);
          $("#editIssueBiblio").val(issue);
          $("#editPagesBiblio").val(pages);
          $("#editEditorsBiblio").val(editors);
          $("#editTypeBiblio").val(type);
          $("#editNoteBiblio").val(note);
    	
    	    //remove card border
          $(".open").css('display', 'none');
          $(".open").css('overflow-y', 'scroll');
          $(".open").css('max-height', '200px');	
    }
    else {
    	// store image ID selected by the user to replace, onDoubleClick
    	var imgID = $(e.target).attr('id'); 
    	if(imgID != ''){
        	$("#uploadImage").data('value', imgID); // sets image ID value
        	$("#addImgAlert").show();
    	}
	
    }
}
    
function uploadImage() {
   	
	var imgID = $("#uploadImage").data('value') // gets image ID
    var file = $('#file')[0].files[0];
	var fileName = file.name;
    var reader  = new FileReader();
    var formData = new FormData();
    formData.append('file', file);
    formData.append('content', file.name);
    formData.append('contentOrder', contentCount);
    var imageblock = "";
 	var oldImageBlock = "";
    
    // Ashmi changes for Story VSPC-64
    
	// checks if image ID is present to replace
    if (imgID != '') {
    	oldImageBlock = $("#" + imgID);
    	var imageBlockId = imgID;
    	formData.append('imageBlockId',imageBlockId);
        var url = "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/image/'})]" + imageBlockId + '?[(${_csrf.parameterName})]=[(${_csrf.token})]';
        reader.onload = function (theFile) {
	        var image = new Image();
	        image.src = theFile.target.result;
	        image.onload = function () {
	            imageblock = createImageBlock(reader, this.width);
	            $("#" + imageBlockId).replaceWith(imageblock);	
	            $(imageblock[0]).mouseenter(onMouseEnter).mouseleave(onMouseLeave).dblclick(onDoubleClick);
        	};
        }
        // Reset data-attribute to get current selected image ID
        $("#uploadImage").data('value', '');
      }
  	else {
  	  var url = "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/image/?'+${_csrf.parameterName}+'='+${_csrf.token}})]";
        reader.onload = function (theFile) {        	
        	var image = new Image();
            image.src = theFile.target.result;
            image.onload = function() {
            	imageblock = createImageBlock(reader, this.width);  
            	$('#slideSpace').append(imageblock); 
                $(imageblock[0]).mouseenter(onMouseEnter).mouseleave(onMouseLeave).dblclick(onDoubleClick);
            };          
        }
        ++contentCount; 
    }
  	
    reader.readAsDataURL(file);
    $.ajax({
        enctype: 'multipart/form-data',
        // ------------- creating image content blocks ------------
        url: url,
        type: 'POST',
        cache       : false,
        contentType : false,
        processData : false,
        data: formData,
        
        success: function(data) {
            $(".open").removeClass("open");
           	var img = imageblock.find('img');
           	if(data != ''){
           		img.attr('id', data);
           		$("#current").find('#deleteImageId').val(data);
           		$("#current").attr('id', data);
           	}
           	else{
           		img.attr('id', imgID);
           		$("#current").find('#deleteImageId').val(imgID);
           		$("#current").attr('id', imgID);
           	}
        },
        error: function(data) {
        	if (imgID == '') {
        		$("#current").remove();
        	}
        	else {
        		$("#current").replaceWith(oldImageBlock);
        	}
        	if (data.status == 403) {
        		$("#loginAlert").show();
        	}
        }
    });
    // Reset the image file name 
   	$('#file').val('');
}

$(document).ready(function() {
    
    [# th:if="${#strings.equals(slide['class'].simpleName,'BranchingPoint')}"]
		$('#addChoice').show();
		$('#choiceSpace').show();
	[/]
	

    //-------- edit contentblock description --------

    $("#submitDescription").hide()
    $("#cancelEditDescription").hide()
    var description = $("#description").text()
    $("#editDescription").click(function() {
        $('<textarea id="newDescription" style="margin-top: 1%;" class="form-control" type="text">'+description+'</textarea>').insertBefore( "#description" );
        $("#description").remove()
        $("#editDescription").hide()
        $("#submitDescription").show()
        $("#cancelEditDescription").show()
        
    });

    $("#submitDescription").click(function() {
        var formData = new FormData();
        formData.append('description', $("#newDescription").val());
        $.ajax({ 
	        url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/edit/description?'+${_csrf.parameterName}+'='+${_csrf.token}})]",
	        type: 'POST',
	        cache       : false,
	        contentType : false,
	        processData : false,
	        data: formData,
	        enctype: 'multipart/form-data',
	        success: function(data) {
	            // replace text box with new description
	            $("#submitDescription").hide()
	            $("#cancelEditDescription").hide()
	            $("#editDescription").show()
	            var val = $("#newDescription").val();
	            $('<p id="description"style="margin-top: .5rem; margin-bottom: .5rem;"></p>').insertBefore( "#newDescription" );
	            $("#newDescription").remove();
	            $("#description").text(val)
	        },
	        error: function(data) {
	            $(".open").removeClass("open");
	                var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
	                $('.error').append(alert);
	        }
         });       
      });
    
    $("#cancelEditDescription").click(function(){
        $("#submitDescription").hide()
        $("#editDescription").show()
        $("#cancelEditDescription").hide()
        $('<p id="description" style="margin-top: .5rem; margin-bottom: .5rem;"></p>').insertBefore( "#newDescription" );
        $("#newDescription").remove()
        $("#description").text(description)
        
    });
    
    //------- edit title --------
    $("#submitTitle").hide();
    $("#cancelEditTitle").hide();
    var getTitleText = $("#title").text().split(": ")[1]
    $("#editTitle").click(function() {
        $('<div class="col-4"><input id="newTitle" class="form-control" type="text"></div>').insertAfter( "#title" );
        $('#title').text('Slide: ')
        $("#newTitle").val(getTitleText)
        $("#editTitle").hide()
        $("#submitTitle").show()
        $("#cancelEditTitle").show()       
    });
    
    $("#submitTitle").click(function() {
        var formData = new FormData();
        formData.append('title', $("#newTitle").val());
        $.ajax({
            url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/edit/title?'+${_csrf.parameterName}+'='+${_csrf.token}})]",
            type: 'POST',
            cache       : false,
            contentType : false,
            processData : false,
            data: formData,
            enctype: 'multipart/form-data',
            success: function(data) {
                // replace text box with new description
                $("#submitTitle").hide()
                $("#cancelEditTitle").hide();
                $("#editTitle").show()
                var val = $("#newTitle").val();
                $("#newTitle").closest('div').remove();
                $("#title").text("Silde: " + val)
                
            },
            error: function(data) {
                var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
                $('.error').append(alert);
            }
        });
      });
   $("#cancelEditTitle").click(function(){
        $("#submitTitle").hide()
        $("#editTitle").show()
        $("#cancelEditTitle").hide()
        $("#newTitle").closest('div').remove();
        $("#title").text("Silde: " + getTitleText);
   });
   
    $("#addText").click(function() {
        $(".EasyMDEContainer").remove();
    	markDown = new EasyMDE({element: $('#textBlockText')[0]});
        $("#addTextAlert").show();
    });
    
    $("#addImage").click(function() {
        $("#addImgAlert").show();
    });
    
    $("#uploadImage").click(function(e) {
        e.preventDefault();
            $("#addImgAlert").hide();
            uploadImage();
    });
    
    $("#addChoice").click(function() {
        $("#addChoiceAlert").show();
    });
    
    $(document).on("click", ".deleteText", function(e) {
		$("#confirmDeleteTextAlert").show();
		var alert = $('<input type="hidden" id="deleteTextId">');
		$(alert).attr( 'value', $(this).siblings('input').val());
		$('.modal-footer').append(alert); 
  	});
  	
  	$("#addBibliography").click(function() {
        $("#addBiblioAlert").show();
    });
    
    $(document).on("click", ".deleteBiblio", function(e) {
		$("#confirmDeleteBiblioAlert").show();
		var alert = $('<input type="hidden" id="deleteBiblioId">');
		$(alert).attr( 'value', $(this).siblings('input').val());
		$('.modal-footer').append(alert); 
  	});
	
	$(document).on("click", ".deleteImage", function(e) {
		$("#confirmDeleteImageAlert").show();
		var alert = $('<input type="hidden" id="deleteImageId">');
		$(alert).attr( 'value', $(this).siblings('input').val());
		$('.modal-footer').append(alert); 
  	});
	
	$(document).on("click", ".deleteChoiceBlock", function(e) {
		$("#confirmDeleteChoiceBlockAlert").show();
		var alert = $('<input type="hidden" id="deleteChoiceBlockId">');
		$(alert).attr( 'value', $(this).siblings('input').val());
		$('.modal-footer').append(alert); 
  	});
    
    $("#cancelSubmitText").click(function() {
		$("#addTextAlert").hide();	
	});
	
	$("#cancelDeleteText").click(function() {
		$("#confirmDeleteTextAlert").find('input').remove();
		$("#confirmDeleteBiblioAlert").find('input').remove();
		$("#confirmDeleteImageAlert").find('input').remove();
		$("#confirmDeleteChoiceBlockAlert").find('input').remove();
		$("#confirmDeleteTextAlert").hide();
	});
	
	$("#cancelDeleteImage").click(function() {
		$("#confirmDeleteImageAlert").hide();
	});
	
	$("#cancelSubmitBiblio").click(function() {
		$("#addBiblioAlert").hide();	
	});
	
	$("#cancelDeleteBiblio").click(function() {
		$("#confirmDeleteTextAlert").find('input').remove();
		$("#confirmDeleteBiblioAlert").find('input').remove();
		$("#confirmDeleteImageAlert").find('input').remove();
		$("#confirmDeleteChoiceBlockAlert").find('input').remove();
		$("#confirmDeleteBiblioAlert").hide();
	});
	
	$("#cancelDeleteChoiceBlock").click(function() {
	    $("#confirmDeleteChoiceBlockAlert").find('input').remove();
	    $("#confirmDeleteTextAlert").find('input').remove();
	    $("#confirmDeleteBiblioAlert").find('input').remove();
		$("#confirmDeleteImageAlert").find('input').remove();
		$("#confirmDeleteChoiceBlockAlert").hide();
	});
	
	$("#cancelDelete").click(function() {
		$("#confirmDeleteTextAlert").find('input').remove();
		$("#confirmDeleteBiblioAlert").find('input').remove();
		$("#confirmDeleteImageAlert").find('input').remove();
		$("#confirmDeleteChoiceBlockAlert").find('input').remove();
		$("#confirmDeleteImageAlert").hide();	
	});
	
    	// ---------- Delete Text Block -------------
	
		$("#deleteText").on("click", function(e) {
		e.preventDefault();
		$("#confirmDeleteBiblioAlert").find('input').remove();
		$("#confirmDeleteImageAlert").find('input').remove();
		$("#confirmDeleteChoiceBlockAlert").find('input').remove();
		$("#confirmDeleteTextAlert").hide();
		var blockId = $('#deleteTextId').attr('value');
		$('#deleteTextId').remove()
		
		// ------------- delete text content blocks ------------
		$.ajax({
		    url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/text/'})]"+blockId+'?'+[[${_csrf.parameterName}]]+'='+[[${_csrf.token}]],
		    type: 'DELETE',
		    success: function(result) {
		        $('#' + blockId).remove();
		        
		    },
			error: function(data) {
				var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try to delete again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
				$('.error').append(alert); 
				$(".error").delay(4000).slideUp(500, function(){
				    $(".error").empty();
				});
			}
		});
	});
    	
		// ---------- Delete Bibliography Block -------------
		
		$("#deleteBiblio").on("click", function(e) {
		e.preventDefault();
		$("#confirmDeleteTextAlert").find('input').remove();
		$("#confirmDeleteImageAlert").find('input').remove();
		$("#confirmDeleteChoiceBlockAlert").find('input').remove();
		$("#confirmDeleteBiblioAlert").hide();
		var blockId = $('#deleteBiblioId').attr('value');
		$('#deleteBiblioId').remove();
		var token =  $('input[name="_csrf"]').attr('value');
		
		// ------------- delete Bibliography content blocks ------------
		$.ajax({
		    url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/biblio/'})]"+blockId,
		    type: 'DELETE',
		    headers: {
                'X-CSRF-Token': token 
           	},
		    success: function(result) {
		        $('#' + blockId).remove();
		        
		    },
			error: function(data) {
				var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try to delete again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
				$('.error').append(alert); 
				$(".error").delay(4000).slideUp(500, function(){
				    $(".error").empty();
				});
			}
		});
	});
	
	// ---------- Delete Image Block -----------
	
	$("#deleteImage").on("click", function(e) {
		e.preventDefault();
		$("#confirmDeleteTextAlert").find('input').remove();
		$("#confirmDeleteBiblioAlert").find('input').remove();
		$("#confirmDeleteChoiceBlockAlert").find('input').remove();
		$("#confirmDeleteImageAlert").hide();
		var blockId = $('#deleteImageId').attr('value');
		if(blockId == null || blockId == ''){
			var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try to delete again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
			$('.error').append(alert); 
			$(".error").delay(4000).slideUp(500, function(){
			    $(".error").empty();
			});
		} else{
			$('#deleteImageId').remove()
			// ------------- delete image content blocks ------------
			$.ajax({
			    url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/image/'})]"+blockId+'?'+[[${_csrf.parameterName}]]+'='+[[${_csrf.token}]],
			    type: 'DELETE',
			    success: function(result) {
			    	$('#' + blockId).remove();
			    },
				error: function(data) {
					var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try to delete again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
					$('.error').append(alert); 
					$(".error").delay(4000).slideUp(500, function(){
					    $(".error").empty();
					});
				}
			});
		}
	});
	
	$("#deleteChoiceBlock").on("click", function(e) {
	    e.preventDefault();
	    $("#confirmDeleteTextAlert").find('input').remove();
	    $("#confirmDeleteBiblioAlert").find('input').remove();
	    $("#confirmDeleteImageAlert").find('input').remove();
		$("#confirmDeleteChoiceBlockAlert").hide();
		var blockId = $('#deleteChoiceBlockId').attr('value');
		if(blockId == null || blockId == ''){
			var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try to delete again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
			$('.error').append(alert); 
			$(".error").delay(4000).slideUp(500, function(){
			    $(".error").empty();
			});
		} else{
			$('#deleteChoiceBlockId').remove()
			// ------------- delete choices content blocks ------------
			$.ajax({
			    url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/choiceBlock/'})]"+blockId+'?'+[[${_csrf.parameterName}]]+'='+[[${_csrf.token}]],
			    type: 'DELETE',
			    success: function(result) {
			    	$('#' + blockId).remove();
			    },
				error: function(data) {
					var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try to delete again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
					$('.error').append(alert); 
					$(".error").delay(4000).slideUp(500, function(){
					    $(".error").empty();
					});
				}
			});
		}
	});
	
					
    

    
	$("#cancelSubmitChoice").click(function() {
        $("#addChoiceAlert").hide();	
    });
	
    $("#cancelImageBtn").click(function() {
    	// Initialize selected image ID to blank, on clicking cancel button
    	$("#uploadImage").data('value', '');
        $("#addImgAlert").hide();
        $(".open").removeClass("open");
    });
    
    $("#submitText").on("click", function(e) {
        $("#addTextAlert").hide();
        e.preventDefault();
        // ------------- creating text content blocks ------------
        
        var formData = new FormData();
        var text = markDown.value();
        formData.append('content', text);
        ++contentCount;
        formData.append('contentOrder', contentCount);
        markDown.value('');
        $.ajax({
            url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/textcontent?'+${_csrf.parameterName}+'='+${_csrf.token}})]",
            type: 'POST',
            cache       : false,
            contentType : false,
            processData : false,
            data: formData,
            enctype: 'multipart/form-data',
            success: function(data) {

                var textblock = $('<div id="'+ data +'" class="textDivStaff tab row"><p>'+text+'<input type="hidden" id="deleteTextId" value="'+data+'" /><a class="btn deleteText" href="javascript:;" style="position: absolute; right:0;"><i style="color: var(--error);" class="fas fa-trash-alt"></i></a></p></div>');
                $(textblock).css({
                    'margin': "10px"
                });
                $(textblock[0]).mouseenter(onMouseEnter).mouseleave(onMouseLeave).dblclick(onDoubleClick);
                $('#slideSpace').append(textblock);             
            },
            error: function(data) {
            	if (data.status == 403){
            		$("#loginAlert").show();
            	}
            	else {
                	var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
                	$('.error').append(alert);
            	}
            }
        });
    });

    
    $("#submitBiblio").on("click", function(e) {
        e.preventDefault();
        // ------------- creating Bibliography content blocks ------------
        
        var formData = new FormData();
        var title = $("#titleBiblio").val();
        var author = $("#authorBiblio").val();
        var year = $("#yearBiblio").val();
        var journal = $("#journalBiblio").val();
        var url = $("#urlBiblio").val();
        var volume = $("#volumeBiblio").val();
        var issue = $("#issueBiblio").val();
        var pages = $("#pagesBiblio").val();
        var editors = $("#editorsBiblio").val();
        var type = $("#typeBiblio").val();
        var note = $("#noteBiblio").val();
        
        formData.append('title', title);
        formData.append('author', author);
        formData.append('year', year);
        formData.append('journal', journal);
        formData.append('url', url);
        formData.append('volume', volume);
        formData.append('issue', issue);
        formData.append('pages', pages);
        formData.append('editors', editors);
        formData.append('type', type);
        formData.append('note', note);
        ++contentCount;
        formData.append('contentOrder', contentCount);
        $("#addBiblioAlert").hide();
        
        var object = {};
        formData.forEach((value, key) => object[key] = value);
        var jsonData = JSON.stringify(object);
        var token =  $('input[name="_csrf"]').attr('value');
        
        $.ajax({
            url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/bibliography'})]",
            type: 'POST',
            cache       : false,
            contentType : 'application/json; charset=utf-8',
            processData : false,
            headers: {
                'X-CSRF-Token': token 
           	},
            data: jsonData,
            success: function(data) {
            	console.log(data)
                var biblioblock = $('<div id="'+ data +'" class="biblioDivStaff tab row"><p> Title: <span>' + title + '</span>, Author: <span>' + author + '</span>, Year:' 
                		+ '<span>' + year + '</span>, Journal: <span>' + journal + '</span>, '
                		+ 'Url: <span>' + url + '</span>, Volume: <span>' + volume + '</span>, '
						+ 'Issue: <span>' + issue + '</span>, Pages: <span>' + pages + '</span>, '
						+ 'Editors: <span>' + editors + '</span>, Type: <span>' + type + '</span>, '
						+ 'Note: <span>' + note + '</span>'
                		+ '<input type="hidden" id="deleteBiblioId" value="'+data+'" /><a class="btn deleteBiblio" href="javascript:;" style="position: absolute; right:0px;"><i style="color: var(--error);" class="fas fa-trash-alt"></i></a></p></div>');
                
                $(biblioblock[0]).mouseenter(onMouseEnter).mouseleave(onMouseLeave).dblclick(onDoubleClick);
                $('#slideSpace').append(biblioblock);             
            },
            error: function(data) {
            	if (data.status == 403){
            		$("#loginAlert").show();
            	}
            	else {
                	var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
                	$('.error').append(alert);
            	}
            }
            
        });
    });
    
    $('input:checkbox').click(function() {
        if ($(this).is(':checked')) {
        	$('#submitChoices').prop("disabled", false);
        } else {
        if ($('.choiceOptions').filter(':checked').length < 1){
        	$('#submitChoices').attr('disabled',true);}
        }
    });
    
    $("#submitChoices").on("click", function(e) {
        e.preventDefault();
        $("#addChoiceAlert").hide();
        var selectedChoice = [];
        var showsAll = false;
        $('#selectChoices :checked').each(function() {
        	selectedChoice.push($(this).attr("id"));
          });
        // ------------- creating choice content blocks ------------
        if ($('#showAllChoices').is(':checked')) {
            showsAll = true;
        }
        var formData = new FormData();
        formData.append('selectedChoices', selectedChoice);
        ++contentCount;
        formData.append('contentOrder', contentCount);
        formData.append('showsAll', showsAll);
        $.ajax({
            url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/choice/content?'+${_csrf.parameterName}+'='+${_csrf.token}})]",
            type: 'POST',
            cache       : false,
            contentType : false,
            processData : false,
            data: formData,
            enctype: 'multipart/form-data',
            success: function(data) {
                var choiceblock = $('<div id="'+ data['choiceBlock'].id +'" class="choiceDiv tab row" style="display:block;">');
                if (data['choiceBlock'].showsAll == false){
                    $.each(data['selectedSequences'], function(index, sequence) {
                        choiceblock.append('<a style="color:var(--primary);  display:block;" href="/vspace/staff/module/[(${module.id})]/sequence/'+sequence.id+'">'+sequence.name+'</a>');
            	});
                }else{
                	$(function() {
                        var links = $("#choiceSpaceData a").map(function(e) {
                            text = '<a style="color:var(--primary); display:block;" href='+this.href+'>'+this.name+'</a>';
                            return text;
                        }).get();
                        $(links).each(function(index, choice) {
                            choiceblock.append(choice);
                        });
                   });
                }
                choiceblock.append('<input type="hidden" id="deleteChoiceBlockId" value="'+ data['choiceBlock'].id +'"><a class="btn deleteChoiceBlock col-md-1" href="javascript:;" style="position: absolute; right: 0; top: 0"><i style="color: var(--error);" class="fas fa-trash-alt"></i></a></div>')
            	$(choiceblock).css({
                    'display': "block"
                });
                $('#slideSpace').append(choiceblock);
            },
            error: function(data) {
                var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
                $('.error').append(alert);
            }
        });
        $('#choiceForm')[0].reset();
    });

    
    function updateTextBox(blockId, text) {
        // clear text box and buttons
        $(".open").empty();
        $(".open").append('<p class="col-md-10">'+text+'</p><input type="hidden" id="deleteTextId" value="'+blockId+'" /><a class="btn deleteText col-md-1" href="javascript:;" style="position: absolute; right:0;"><i style="color: var(--error);" class="fas fa-trash-alt"></i></a>');
        // reset border of the card
        //rebind event handlers
        
        $('.textDivStaff').mouseenter(onMouseEnter).mouseleave(onMouseLeave).dblclick(onDoubleClick);
        $(".open").css('display', 'flex');
        // remove id from storage so its not there on refresh
        $(".open").removeClass("open");
    }
    
    // must add the event to the document since the buttons are added dynamically
    $('#cancelTextBlock').on('click',function(){
    	$("#editTextAlert").hide();
    	var blockId = $(this).closest(".open").attr("id");
    	updateTextBox(blockId, defaultValue);
    });
    
    function updateBiblioBox(blockId, formData, defaultValue) {
        // clear biblio box and buttons
        $(".open").empty();
        if(formData!=null)
        	$(".open").append('<p class="col-md-10">Title: ' + formData.get('title')+ ', Author: ' + formData.get('author') + ', Year: ' + formData.get('year') + ', Journal: ' + formData.get('journal') 
        			+ ', Url: ' + formData.get('url') + ', Volume: ' + formData.get('volume') + ', Issue: ' + formData.get('issue') 
        			+ ', Pages: ' + formData.get('pages') + ', Editors: ' + formData.get('editors') + ', Type: ' + formData.get('type')
        			+ ', Note: ' + formData.get('note')
        			+ '</p><input type="hidden" id="deleteBiblioId" value="'+blockId+'" /><a class="btn deleteBiblio col-md-1" href="javascript:;" style="position: absolute; right:0px;"><i style="color: var(--error);" class="fas fa-trash-alt"></i></a>');
        else if(defaultValue!=null) {
        	$(".open").append('<p class="col-md-10">' + defaultValue + '</p><input type="hidden" id="deleteBiblioId" value="'+blockId+'" /><a class="btn deleteBiblio col-md-1" href="javascript:;" style="position: absolute; right:0px;"><i style="color: var(--error);" class="fas fa-trash-alt"></i></a>');
        }
        //reset border of the card
        //rebind event handlers
        $('.biblioDivStaff').mouseenter(onMouseEnter).mouseleave(onMouseLeave).dblclick(onDoubleClick);
        $(".open").css('display', 'flex');
        // remove id from storage so its not there on refresh
        $(".open").removeClass("open");
    }
    
 	// must add the event to the document since the buttons are added dynamically
    $('#cancelBiblioBlock').on('click',function(){
    	$("#editBiblioAlert").hide();
    	var blockId = $(this).closest(".open").attr("id");
    	updateBiblioBox(blockId, null, defaultValue);
    });

    $('.valueDiv').mouseenter(onMouseEnter).mouseleave(onMouseLeave).dblclick(onDoubleClick);
    $('.textDivStaff').mouseenter(onMouseEnter).mouseleave(onMouseLeave).dblclick(onDoubleClick);
    $('.biblioDivStaff').mouseenter(onMouseEnter).mouseleave(onMouseLeave).dblclick(onDoubleClick);

    $("#submitTextBlock").on("click", function(e){
    	e.preventDefault();
        // ------------- editting text content blocks ------------
        
        var formData = new FormData();
        var text = markDown.value();
        markDown.value('');
        var formData = new FormData();
        var blockId = $(".open").attr("id");
        formData.append('textBlockDesc', text);
        formData.append('textBlockId', blockId);
    	$("#editTextAlert").hide();
        $.ajax({
            url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/text/edit?'+${_csrf.parameterName}+'='+${_csrf.token}})]",
            type: 'POST',
            cache       : false,
            contentType : false,
            processData : false,
            data: formData,
            enctype: 'multipart/form-data',
            success: function(data) {
                // replace text box with new description
               updateTextBox(blockId, text)
               $(".open").removeClass("open");
           },
           error: function(data) {
        		if (data.status == 403) {
           			$("#loginAlert").show();
           		}
           		else {
               		var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
               		$('.error').append(alert);
           		}
           }
       });
    });
    
    $("#submitBiblioBlock").on("click", function(e){
    	  e.preventDefault();
        // ------------- editting Bibliography content blocks ------------
        
        var formData = new FormData();
        var title = $("#editTitleBiblio").val();
        var author = $("#editAuthorBiblio").val();
        var year = $("#editYearBiblio").val();
        var journal = $("#editJournalBiblio").val();
        var url = $("#editUrlBiblio").val();
        var volume = $("#editVolumeBiblio").val();
        var issue = $("#editIssueBiblio").val();
        var pages = $("#editPagesBiblio").val();
        var editors = $("#editEditorsBiblio").val();
        var type = $("#editTypeBiblio").val();
        var note = $("#editNoteBiblio").val();
        var blockId = $(".open").attr("id");
        
        formData.append('title', title);
        formData.append('author', author);
        formData.append('year', year);
        formData.append('journal', journal);
        formData.append('url', url);
        formData.append('volume', volume);
        formData.append('issue', issue);
        formData.append('pages', pages);
        formData.append('editors', editors);
        formData.append('type', type);
        formData.append('note', note);
        formData.append('id', blockId);
        $("#editBiblioAlert").hide();
        
        var object = {};
        formData.forEach((value, key) => object[key] = value);
        var jsonData = JSON.stringify(object);
        var token =  $('input[name="_csrf"]').attr('value');
        
        $.ajax({
            url: "[(@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/biblio/edit'})]",
            type: 'POST',
            cache       : false,
            contentType : 'application/json; charset=utf-8',
            processData : false,
            headers: {
                'X-CSRF-Token': token 
           	},
            data: jsonData,
            success: function(data) {
                //replace Biblio box with new values
                updateBiblioBox(blockId, formData, null)
                $(".open").removeClass("open");
           },
           error: function(data) {
	       if (data.status == 403) {
	           $("#loginAlert").show();
	       }
	       else {
	           var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>We are sorry but something went wrong. Please try again later.</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
	           $('.error').append(alert);
	       }
           }
       });
    });    
});

$(window).on('load', function () {
	var divWindow = $(".valueDiv");
	$(".deleteText").css('position', 'absolute');
	$(".deleteText").css('right', '0');
	$(".deleteBiblio").css('position', 'absolute');
	$(".deleteBiblio").css('right', '0px');
	var images = $(".imgDiv");
	resizeImage(images);
	
	function resizeImage(images) {
		for(var i =0; i < images.length; i++) {
			if (images[i].width > divWindow.width() || images[i].width >= 800) {
				$(".valueDiv").find("#"+images[i].id).css("width", 800);
				images[i].width = 800;
			} else {
				$(".valueDiv").find("#"+images[i].id).css("width", images[i].width);
			}
		}
	}
});

</script>
</head>
<body>
    <div class="main-content" layout:fragment="content">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
            	<a th:href="@{/staff/dashboard}">Dashboard</a></li>
            <li class="breadcrumb-item">
            	<a th:href="@{/staff/module/list}">Modules</a></li>
            <li class="breadcrumb-item">
            	<a th:href="@{'/staff/module/'+${module.id}}">[[${module.name}]]</a></li>
            <li class="breadcrumb-item" th:each="slideSequence: ${slideSequences}">
            	<a th:href="@{'/staff/module/'+${module.id}+'/sequence/'+${slideSequence.id}}" th:name="${slideSequence.name}">[[${slideSequence.name}]]</a></li>	
            <li class="breadcrumb-item active">[[${slide.name}]]</li>
        </ol>
        
        <div class="error"></div>
        
		<div class="dropdown" style="float: right;" th:if="${#strings.equals(slide['class'].simpleName,'BranchingPoint')}">
        	<button class="btn branchbtn dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    	<span class="icon-branch"></span> This Branching Point links to the following Sequences
			</button>
			<div id="choiceSpaceData" class="dropdown-menu" aria-labelledby="dropdownMenu2">
			    <a  th:each="choice: ${choices}" class="dropdown-item" 
			    	th:href="@{'/staff/module/'+${module.id}+'/sequence/'+${choice.sequence.id}}"
	                th:name="${choice.sequence.name}" style="color:var(--primary);">[[${choice.sequence.name}]]</a>
			</div>
        </div>
        
        <h2><span style="color: var(--dark-grey)">Slide:</span> [[${slide.name}]]
        	<span class="icon-info-circle" data-toggle="tooltip" data-html="true" data-placement="top" 
	   			th:title="|Created on <span class='date'>${slide.creationDate}</span> by ${slide.createdBy}|"></span>&emsp;
	   		<a th:href="@{'/staff/module/'+${module.id}+'/slide/'+${slide.id}+'/edit'}">
        		<span class="icon-edit"></span></a>
        </h2>
        <p id="description">[[${slide.description}]]</p>
        
        <div style="margin: 40px 0">
        	<button type="button" id="addText" class="btn pill-btn" data-toggle="tooltip" title="Add Text Block" data-placement="top">
        		+&nbsp;<span class="icon-text"></span></button>&nbsp;
        	<button type="button" id="addImage" class="btn pill-btn" data-toggle="tooltip" title="Add Image" data-placement="top">
        		+&nbsp;<span class="icon-image"></span></button>&nbsp;
        	<button type="button" id="addBibliography" class="btn pill-btn" data-toggle="tooltip" title="Add Bibliography block" data-placement="top">
        		+&nbsp;<span class="bi bi-bookmarks"></span></button>&nbsp;
        	<button type="button" id="addChoice" style="display: none;" class="btn pill-btn" data-toggle="tooltip" title="Add Sequence Choice" data-placement="top">
        		+&nbsp;<span class="icon-checkmark"></span></button>
            <p style="margin-top: 1rem;">Double Click on a Block to Edit it</p>
        </div>

		<!-- Delete Text Modal -->
		<div id="confirmDeleteTextAlert" class="modal" tabindex="-1"
			role="dialog" th:draggable="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Confirm Delete</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<h6>Are you sure you want to delete this text block?</h6>
					</div>
					<div class="modal-footer">
						<button id="cancelDeleteText" type="reset" class="btn light">Cancel</button>
						<button type="submit" id="deleteText" class="btn btn-primary">Submit</button>
					</div>
				</div>
			</div>
		</div>
		
		<!-- Delete Bibliography Modal -->
		<div id="confirmDeleteBiblioAlert" class="modal" tabindex="-1"
			role="dialog" th:draggable="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Confirm Delete</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<h6>Are you sure you want to delete this bibliography block?</h6>
					</div>
					<div class="modal-footer">
						<button id="cancelDeleteBiblio" type="reset" class="btn light">Cancel</button>
						<button type="submit" id="deleteBiblio" class="btn btn-primary">Submit</button>
					</div>
				</div>
			</div>
		</div>
		
		<!-- Delete Image Modal -->
		<div id="confirmDeleteImageAlert" class="modal" tabindex="-1"
			role="dialog" th:draggable="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Confirm Delete</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<h6>Are you sure you want to delete this image block?</h6>
					</div>
					<div class="modal-footer">
						<button id="cancelDelete" type="reset" class="btn light">Cancel</button>
						<button type="submit" id="deleteImage" class="btn btn-primary">Submit</button>
					</div>
				</div>
			</div>
		</div>

        <!-- Delete ChoiceBlock Modal -->
        <div id="confirmDeleteChoiceBlockAlert" class="modal"
            tabindex="-1" role="dialog" th:draggable="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm Delete</h5>
                        <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h6>Are you sure you want to delete this
                            choices Block?</h6>
                    </div>
                    <div class="modal-footer">
                        <button id="cancelDeleteChoiceBlock"
                            type="reset" class="btn light">Cancel</button>
                        <button type="submit" id="deleteChoiceBlock"
                            class="btn btn-primary">Submit</button>
                    </div>
                </div>
            </div>
        </div>



        <div id="addTextAlert" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document" th:draggable="true">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add new Text Block</h5>
                        <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form name="textForm" id="textUploadForm"
                        enctype="multipart/form-data" method="post">
                        <div class="modal-body">
                            <h6>
                                <small>Enter Text: </small>
                            </h6>
                            <textarea class="form-control"
                                id="textBlockText" rows="3"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button id="cancelSubmitText" type="reset"
                                class="btn light">Cancel</button>
                            <button type="submit" id="submitText"
                                class="btn btn-primary">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div id="editTextAlert" class="modal" tabindex="-1"
            role="dialog" th:draggable="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Text Block</h5>
                        <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form name="textForm" id="textEditUploadForm"
                        enctype="multipart/form-data" method="post">
                        <div class="modal-body">
                            <h6>
                                <small>Edit Text: </small>
                            </h6>
                            <textarea class="form-control"
                                id="editTextBlock" rows="3"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button id="cancelTextBlock" type="reset"
                                class="btn light">Cancel</button>
                            <button type="submit" id="submitTextBlock"
                                class="btn btn-primary">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


        <div id="addImgAlert" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document" th:draggable="true">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add new Image Block</h5>
                        <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form name="photoForm" id="imageUploadForm"
                        enctype="multipart/form-data" method="post">
                        <div class="modal-body">
                            <h6>
                                <small>Upload Image: </small>
                            </h6>
                            <input class="form-control" type="file"
                                name="file" rows="5" cols="500"
                                id="file" />
                        </div>
                        <div class="modal-footer">
                            <button id="cancelImageBtn" type="reset"
                                class="btn light">Cancel</button>
                            <button type="submit" id="uploadImage"
                                class="btn btn-primary" data-value="">Upload
                                Image</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

		<div id="addBiblioAlert" class="modal" tabindex="-1" role="dialog" style="overflow-y: scroll;">
			<div class="modal-dialog" role="document" th:draggable="true">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Add new Bibliography Block</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<form name="sendBiblioForm" id="sendBiblioForm">
						<div class="modal-body">
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Title:</label>
										</td>
										<td><input type="text" class="form-control"
											id="titleBiblio" name="titleBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Author:</label>
										</td>
										<td><input type="text" class="form-control"
											id="authorBiblio" name="authorBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Year:</label>
										</td>
										<td><input type="text" class="form-control"
											id="yearBiblio" name="yearBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Journal:</label>
										</td>
										<td><input type="text" class="form-control"
											id="journalBiblio" name="journalBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Url:</label>
										</td>
										<td><input type="text" class="form-control"
											id="urlBiblio" name="urlBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Volume:</label>
										</td>
										<td><input type="text" class="form-control"
											id="volumeBiblio" name="volumeBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Issue:</label>
										</td>
										<td><input type="text" class="form-control"
											id="issueBiblio" name="issueBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Pages:</label>
										</td>
										<td><input type="text" class="form-control"
											id="pagesBiblio" name="pagesBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Editors:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editorsBiblio" name="editorsBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Type:</label>
										</td>
										<td><input type="text" class="form-control"
											id="typeBiblio" name="typeBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Note:</label>
										</td>
										<td><input type="text" class="form-control"
											id="noteBiblio" name="noteBiblio" /></td>
									</tr>
								</table>
							</div>
						</div>
						<div class="modal-footer">
							<button id="cancelSubmitBiblio" type="reset" class="btn light">Cancel</button>
							<button type="submit" id="submitBiblio" class="btn btn-primary">Submit</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<div id="editBiblioAlert" class="modal" tabindex="-1" role="dialog" style="overflow-y: scroll;">
			<div class="modal-dialog" role="document" th:draggable="true">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Edit Bibliography Block</h5>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<form name="sendBiblioForm" id="sendEditBiblioForm">
						<div class="modal-body">
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Title:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editTitleBiblio" name="ediTitleBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Author:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editAuthorBiblio" name="editAuthorBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Year:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editYearBiblio" name="editYearBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Journal:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editJournalBiblio" name="editJournalBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Url:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editUrlBiblio" name="editUrlBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Volume:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editVolumeBiblio" name="editVolumeBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Issue:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editIssueBiblio" name="editIssueBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Pages:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editPagesBiblio" name="editPagesBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Editors:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editEditorsBiblio" name="editEditorsBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Type:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editTypeBiblio" name="editTypeBiblio" /></td>
									</tr>
								</table>
							</div>
							<div class="form-group">
								<table>
									<tr>
										<td><label for="name" class="col-form-label">Note:</label>
										</td>
										<td><input type="text" class="form-control"
											id="editNoteBiblio" name="editNoteBiblio" /></td>
									</tr>
								</table>
							</div>
						</div>
						<div class="modal-footer">
							<button id="cancelBiblioBlock" type="reset" class="btn light">Cancel</button>
							<button type="submit" id="submitBiblioBlock"
								class="btn btn-primary">Submit</button>
						</div>
					</form>
				</div>
			</div>
		</div>

        <div id="loginAlert" class="modal" tabindex="-1" role="dialog"
            backdrop="static"
            style="display: none; background-color: rgba(0, 0, 0, 0.5);">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Login</h5>
                    </div>
                    <div class="modal-body">
                        <h6>You are not logged in, please login.</h6>
                    </div>
                    <div class="modal-footer">
                        <a class="btn btn-primary" style="color: white;"
                            onClick="window.location.reload();">Login</a>
                    </div>
                </div>
            </div>
        </div>

        <div id="addChoiceAlert" class="modal" tabindex="-1"
            role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Select from the
                            Choices</h5>
                        <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form name="choiceForm" id="choiceForm"
                        enctype="multipart/form-data" method="post">
                        <div id="choiceDiv" class="modal-body">
                            <input class="choiceOptions"
                                id="showAllChoices" type="checkbox"
                                name="showAll" value="showAll"
                                checked="true" /> <label for="showAll">Always
                                show all choices</label><br />
                            <div id="selectChoices">
                                <div th:each="choice: ${choices}">
                                    <input class="choiceOptions"
                                        th:id="${choice.id}"
                                        type="checkbox"
                                        th:name="${choice.sequence.name}"
                                        th:value="${choice.sequence.name}" />
                                    <label th:for="${choice.id}">[[${choice.sequence.name}]]</label>
                                    <br />
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="cancelSubmitChoice" type="reset"
                                class="btn light">Cancel</button>
                            <button type="submit" id="submitChoices"
                                class="btn btn-primary">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>



        <div id="slideSpace">
            <div th:each="contents: ${slideContents}">
                <div th:id="${contents.id}" class="valueDiv tab row" th:if="${#strings.equals(contents['class'].simpleName,'ImageBlock')}">
                    <img th:id="${contents.id}" class="imgDiv" th:src="@{'/api/image/'+${contents.image.id}}" />
                    <input type="hidden" id="deleteImageId" th:value="${contents.id}"> 
                    <a class="btn deleteImage col-md-1" href="javascript:;" style="position:absolute; right:25px;"> 
                        <span class="icon-trash error"></span>
                    </a>
                </div>
                <div th:id="${contents.id}" class="textDivStaff tab row" th:if="${#strings.equals(contents['class'].simpleName,'TextBlock')}">
                    <p class="col-md-10"> [[${contents.text}]]</p>
                    <input type="hidden" id="deleteTextId" th:value="${contents.id}" />
                    
                    <a class="btn deleteText col-md-1" href="javascript:;"> 
                    	<span class="icon-trash error"></span>
                    </a>
                </div>
                <div th:id="${contents.id}" class="biblioDivStaff tab row"
					th:if="${#strings.equals(contents['class'].simpleName,'BiblioBlock')}">
					<p class="col-md-10">
						Title: <span>[[${contents.title}]]</span>, Author: <span>[[${contents.author}]]</span>,
						Year: <span>[[${contents.year}]]</span>, Journal: <span>[[${contents.journal}]]</span>,
						Url: <span>[[${contents.url}]]</span>, Volume: <span>[[${contents.volume}]]</span>,
						Issue: <span>[[${contents.issue}]]</span>, Pages: <span>[[${contents.pages}]]</span>,
						Editors: <span>[[${contents.editors}]]</span>, Type: <span>[[${contents.type}]]</span>,
						Note: <span>[[${contents.note}]]</span>
					</p>
					<input type="hidden" id="deleteBiblioId" th:value="${contents.id}" />
					<a class="btn deleteBiblio col-md-1" href="javascript:;"> <span
						class="icon-trash error"></span>
					</a>
				</div>
                <div th:id="${contents.id}" class="choiceDiv tab row" th:if="${#strings.equals(contents['class'].simpleName,'ChoiceBlock')}" style="display:block;">
                    <a th:if="${contents.showsAll}" th:each="choice: ${choices}" style="display:block; color: var(--primary);"
                        th:href="@{'/staff/module/'+${module.id}+'/sequence/'+${choice.sequence.id}}">[[${choice.sequence.name}]]</a>
                    <a th:if="!${contents.showsAll}" th:each="choice: ${contents.choices}" style="display:block; color: var(--primary);"
                        th:href="@{'/staff/module/'+${module.id}+'/sequence/'+${choice.sequence.id}}">[[${choice.sequence.name}]]</a>
                    <input type="hidden" class="col-md-8" id="deleteChoiceBlockId" th:value="${contents.id}"> 
                    <a class="btn deleteChoiceBlock col-md-1" href="javascript:;" style="position:absolute; right:0; top: 0;">
                        <span class="icon-trash error"></span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
