<html layout:decorate="~{layouts/main_staff}">
<head>
	<script th:inline="javascript">
		var authenticatedName = [[${authenticationName}]]
		var spaceLinksSize = [[${spaceLinksSize}]]
		$(function () {
		  $('[data-toggle="tooltip"]').tooltip()
		});
		
	function closeSpaceLinkAlert(){
		$("#spaceLinkAlert").hide();
	}
	
	function deleteSpaceLinks(){
		console.log('here');
		var url = "[(@{'/staff/dashboard/deleteSpaceLinksWithNullSource'+${_csrf.parameterName}+'='+${_csrf.token}})]";
		$.ajax({
    		enctype: 'multipart/form-data',
    		url: url,
    		type: 'DELETE',
    		cache       : false,
    		contentType : false,
    		processData : false,    
    		success: function(data) {
    			console.log('success');
    		},
    		error: function(data) {
    		console.log('not a success')
    		}
    	});
	}
	
	$(window).on('load', function () {
		console.log(spaceLinksSize);
    	if(authenticatedName=="admin" && spaceLinksSize > 0){
    		$("#spaceLinkAlert").show();
    	}
    });
	</script>
</head>
<body>
<div class="justify-content-left" layout:fragment="content">
    <div class="main-content">
    	<h2>Welcome back!</h2>
    	<span>View your most recent edits, or create new items.</span>
		<div class="tab" style="margin-top: 10px; padding: 10px;">
			<h4>Spaces</h4>	
			<div class="grid" style="margin-top: 10px;">
				<div th:each="space,iterStat: ${recentSpaces}" th:if="${iterStat.index}<5" style="width: 12rem;">
					<div class="spaceImage">
                        <a th:href="@{'/staff/space/'+${space?.id}}">
						  <img class="card-img-top" th:src="@{'/api/image/'+${space.image?.id}}" alt="Space image">
                        </a>
					</div>
					<div class="btn-group dropdown">
						<a th:href="@{'/staff/space/'+${space?.id}}" class="btn btn-light skew" style="width: 10.25rem;">
							<span class="card-head" style="white-space: normal;">[[${space.name}]]</span>
						</a>
						<button type="button" class="btn btn-light dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" 
							aria-haspopup="true" aria-expanded="false">
						    <span class="sr-only">Toggle Dropdown</span>
						</button>
						<div class="dropdown-menu">
						    <a class="dropdown-item" th:href="@{'/staff/space/'+${space?.id}+'/edit'}"><span class="icon-edit"></span>&nbsp;Edit Space</a>
						    <div class="dropdown-divider"></div>
						    <a  th:onclick="javascript:checkSpaceLinkPresent('[(${space?.id})]', '[(@{'/staff/'})]', '[('?'+${_csrf.parameterName}+'='+${_csrf.token})]',$('#headerSpaceValue'))"
		                        class="checkSpaceLinkPresent dropdown-item" data-toggle="modal">
		                        <span class="checkSpaceLinkPresent" id="deleteSpace">
		                        <span class="icon-trash error"></span></span>&nbsp;Delete
		                    </a>
						</div>					
					</div>
				</div>
				<a class="add" th:href="@{/staff/space/add}"><span class="icon-circle-add" style="margin: auto; color: var(--med-grey)"></span></a>
			</div>
		</div>
		<div class="tab" style="margin-top: 10px; padding: 10px;">
			<h4>Modules</h4>
			<div class="list" style="margin-top: 10px;">
				<ul class="list-group list-group-flush" th:each="module,iterStat: ${recentModules}" th:if="${iterStat.index}<5" >
                    <li class="list-group-item">
					<a th:href="@{'/staff/module/'+${module?.id}}" style="white-space: normal;overflow-wrap: break-word;">
						<span class='icon-2x2-grid'></span>&nbsp;&nbsp;&nbsp;&nbsp;[[${module.name}]]
					</a>
                    (Created on <span class="date">[[${module.creationDate}]]</span>
                   by [[${module.createdBy}]])
                    </li>
				</ul>
				<br><a class="add" th:href="@{/staff/module/add}"><span class="icon-circle-add" style="margin: auto; color: var(--med-grey)"></span></a>
			</div>
			</div>
    </div> 
    <div id="spaceLinkAlert" class="modal" tabindex="-1" role="dialog"
                backdrop="static"
                style="display: none; background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Login</h5>
                        </div>
                        <div class="modal-body">
                            <h6>There are space links with source space as Null. Do you want to delete them?</h6>
                        </div>
                        <div class="modal-footer">
                            <a class="btn btn-primary" style="color: white;"
                                onClick="deleteSpaceLinks()">Yes</a>
                            <a class="btn btn-primary" style="color: white;"
                           onClick="closeSpaceLinkAlert()">No</a>
                        </div>
                    </div>
                </div>
            </div>    
</div>
</body>
</html>