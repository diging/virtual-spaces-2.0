<html layout:decorate="~{layouts/main_staff}">
<head>
<link th:href="@{/resources/multiselect/css/multiselect.css}"
    type="text/css" rel="stylesheet">
<script th:src="@{/resources/multiselect/js/multiselect.min.js}"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

<script th:inline="javascript">
var spaceDivs = []
$(document).ready(function() {
	var vals = []
	
	spaceDivs = document.getElementById('sortableSpaces').children;
	var spaceIds = [];
	let index =0;
	 for(ele of spaceDivs){
		spaceIds.push(spaceDivs[index].children[0].id);
		index++;
	} 
	 spaceDivs=[];
	 spaceDivs = spaceIds;
	//save order
	$("#createOrder").click(function() {
		var formData = new FormData();
		var name = $("#name").val();
		//console.log(document.getElementById("description").val());
		var descriptonText = $("#description").val();
		console.log(descriptonText);
	    formData.append('spaceOrder', spaceDivs);
	    formData.append('name', name);
	    formData.append('description', description);
	    formData
	    $.ajax({
	        url: "[(@{'/staff/spaceordering/customorder/add'})]"+'?'+[[${_csrf.parameterName}]]+'='+[[${_csrf.token}]],
	        type: 'POST',
	        cache       : false,
	        contentType : false,
	        processData : false,
	        data: formData,
	        enctype: 'multipart/form-data',
	        beforeSend: function(){
	        },
	        complete: function(){
	        },
	        success: function(data) {
	        },
	        error: function(data) {
	            var alert = $('<div class="alert alert-danger alert-dismissible fade show" role="alert"><p>The custom order name is already in use</p><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
	            $('.error').append(alert);
	        }
	    });
	            
	  });
	
	$("#sortableSpaces").sortable({
	  	update: function(event,ui) {
	  		spaceDivs = [];
	      	$(this).children().each(function(index,element){
	      		spaceDivs.push(element.children[0].id);
	      		
	            	//updatedSpaceOrder.push(item);
	      	});
	  	}
		});
	
});
</script>
</head>
<body>
<div id="error">
</div>
    <div class="main-content" layout:fragment="content">
        <h2>Add New Custom Order</h2>
        <div class="form-group row">
                <label class="col-md-2 col-form-label" for="name">Order Name</label>
                <input placeholder="Name" class="form-control col-md-6" type="text" id="name" name="name" />
            </div>
            <div class="form-group row">
                <label class="col-md-2 col-form-label" for="description">Order Description</label>
                <textarea placeholder="Description" rows="5" class="form-control col-md-6" id="description" name="description"></textarea>
            </div>
            <span>Drag and drop to arrange spaces</span>
        <div class="form-group row" id="sortableSpaces">
		<div th:each="selectedSpace: ${spaces}"  class="main-content" >
	    	<div  style="cursor: pointer;" th:draggable="true"  th:id="${selectedSpace.id}" th:attr="data-position=1"class="valueDiv tab row" >
	             <p class="col-md-10">[[${selectedSpace.name}]]</p>
		    </div>
    	</div>
		</div>
		<button id="createOrder" type="button" class="btn primary-btn"
					style="float: left; margin-right: 1%;">Create Order</button>
		
    </div>
</body>
</html>